# Travis config file to build spk package
# Credits to torrentalle, Safihre, ymartin59
notifications:
  email: false

git:
  depth: 1

sudo: required
language: false

# Build environment configuration
env:
  global:
    - PKG=
  matrix:
    - SYNOARCH=88f6281
    - SYNOARCH=alpine
    - SYNOARCH=armada370
    - SYNOARCH=armada375
    - SYNOARCH=armada38x
    - SYNOARCH=armadaxp
    - SYNOARCH=avoton
    - SYNOARCH=braswell
    - SYNOARCH=bromolow
    - SYNOARCH=cedarview
    - SYNOARCH=comcerto2k
    - SYNOARCH=evansport
    - SYNOARCH=monaco
    - SYNOARCH=ppc853x
    - SYNOARCH=qoriq
    - SYNOARCH=x64
    - SYNOARCH=x86

# spksrc docker image
services:
  - docker

before_install:
  - docker pull synocommunity/spksrc

# Build spk package
script:
  # Output is too verbose for TravisCI, so we hide it
  # Remove the ">/dev/null" part to debug!
  - docker run -it -v `pwd`:/spksrc synocommunity/spksrc /bin/bash -c "cd /spksrc && make setup && cd spk/$PKG && make arch-$SYNOARCH >/dev/null"
  # make arch-$SYNOARCH always return exit code 0. This line is to test if SPK has been build.
  - ls packages/${PKG}_${SYNOARCH}*.spk
